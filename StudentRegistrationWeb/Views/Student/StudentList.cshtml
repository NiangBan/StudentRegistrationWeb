@using StudentRegistrationWeb.Extension
@model StudentRegistrationWeb.Models.StudentModel
@{
    ViewBag.Title = "Student List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    
    <div class="col-12">
        <form action="@HtmlExtension.GetEncryptLink("GetStudentListSearch", "Student")" method="post" class="form-fileupload" id="fromearch">

            @Html.AntiForgeryToken()
            @if (!ViewContext.ViewData.ModelState.IsValid)
            {
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            }
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="form-group">
                                @Html.LabelFor(model => model.StudentName)
                                @Html.TextBoxFor(model => model.StudentName, new { @id = "txtStudentName", @class = "form-control", @autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.StudentName, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-2">
                            <div class="form-group">
                                @Html.LabelFor(model => model.StudentNumber)
                                @Html.TextBoxFor(model => model.StudentNumber, new { @id = "txtStudentNo", @class = "form-control", @autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.StudentNumber, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-2">
                            <div class="form-group">
                                @Html.LabelFor(model => model.FatherName)
                                @Html.TextBoxFor(model => model.FatherName, new { @id = "txtFatherName", @class = "form-control", @autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.FatherName, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                @Html.LabelFor(model => model.Phone)
                                @Html.TextBoxFor(model => model.Phone, new { @id = "txtPhone", @class = "form-control", @autocomplete = "off" })
                                @Html.ValidationMessageFor(model => model.Phone, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="col-md-1">
                            <div class="form-group">
                                <input type="submit" class="btn btn-block btn-primary" style="margin-top: 32px; margin-right: 15px" value="Search" @*@Resources.*@ />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
</div>
<div class="row">
    <div class="col-12">
        <div class="card">
            @*<div class="card-header">
                    <h3 class="card-title">DataTable with minimal features & hover style</h3>
                </div>*@
            <!-- /.card-header -->
            <div class="card-body">
                <table id="myTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th><input name="select_all" value="1" type="checkbox"></th>
                            <th>Student Id</th>
                            <th>Student Id</th>
                            <th>Name</th>
                            <th>Father Name</th>
                            <th>NRC</th>
                            <th>Phone</th>
                            <th>Email</th>
                            @*<th>DOB</th>
                                <th>Address</th>
                                <th>University</th>
                                <th>Major</th>
                                <th>Academic Year</th>*@
                            <th>Action</th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Mya Mya</td>
                            <td>U Mya</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>

                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>1</td>
                            <td>CS1</td>
                            <td>Aye Aye</td>
                            <td>U Aye</td>
                            <td>12/TaTaNa(N)123455</td>
                            <td>0922445555</td>
                            <td>aye@gmail.com</td>
                            @*<td>01-02-2000</td>
                                <td>Yangon</td>
                                <td>Computer University</td>
                                <td>CS</td>
                                <td>1st year</td>*@
                            <td>
                                <button type="button" id="btnApprove" class="btn btn-success" @*onclick="getApprove(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Edit</button>
                                <button type="button" id="btnReject" class="btn btn-danger" @*onclick="getReject(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Delete</button>
                                <button type="button" id="btnDetails" class="btn btn-default" @*onclick="getDetails(@items.c_Req_Changes.Id)"*@>@*@Resource.*@Detail</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- /.card-body -->
        </div>
        <!-- /.card -->
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {

            $("#btnOK").on("click", function () {
                var rejReason = $('#rejectReason').val();
                $('#errorRejectReason').remove();
                if (rejReason == null || rejReason == "") {
                    $('#rejectReason').parent().append('<span class="field-validation-error" id="errorRejectReason">RejectReasonRequire</span>');
                }
                else {
                    $('#errorRejectReason').remove();
                    $("#formReject").submit();
                }
            });

        $("#error_message").hide();

        var model = @Html.Raw(Json.Encode(@ViewBag.Message));
        if (model != null && model.RespCode == "888") {
            $("#error_message").text(model.RespDescription);
            $("#error_message").show();
        } else {
            $("#error_message").hide();
        }

        //$('.js-example-basic-single').select2();


        var buttonCommon = {
            exportOptions: {
                columns: ':visible',
                format: {
                    body: function (data, row, column, node) {
                        while (data.charAt(0) == '=') data = data.substring(1);
                        while (data.includes(">") || data.includes("<")) {
                            var startIndex = data.indexOf("<");
                            var endIndex = data.indexOf(">");
                            data = data.substring(0, startIndex) + data.substring(endIndex + 1, data.length);
                        }

                        return data.length > 0 ? '\'' + data.trim() : data;
                    }
                }
            }
        };
        var table = $('#myTable').DataTable({
            "columnDefs": [{
                "targets": [0],
                "orderable": false
            },
            {
                'targets': 0,
                'searchable': false,
                'orderable': false,
                'width': '1%',
                'className': 'dt-body-center',
                'render': function (data, type, full, meta) {
                    if (full[18] == 'Pending' && full[19] == "False") {
                        return '<input type="checkbox">';
                    }
                    else {
                        return '<input type="checkbox">';
                        //return '';
                    }
                }
            },
            {
                'targets': 1,
                'visible': false
                },
                {
                    'targets': 0,
                    'visible': false
                }],
            dom: 'lBfrtip',
            buttons: [
                $.extend(true, {}, buttonCommon, {
                    extend: 'excel'
                }),
                $.extend(true, {}, buttonCommon, {
                    extend: 'csv'
                })
            ],
            'rowCallback': function (row, data, dataIndex) {
                var rowId = data[0]; // get maker tran log
                if ($.inArray(rowId, rows_selected) !== -1) {
                    $(row).find('input[type="checkbox"]').prop('checked', true);
                    $(row).addClass('selected');
                }
            },
            "order": [],
            "scrollCollapse": true,
        });
        var rows_selected = [];

        $('#myTable tbody').on('click', 'input[type="checkbox"]', function (e) {
            var $row = $(this).closest('tr');
            var data = table.row($row).data();
            var rowId = data[1];

            var index = $.inArray(rowId, rows_selected);

            if (this.checked && index === -1) {
                rows_selected.push(rowId);
            } else if (!this.checked && index !== -1) {
                rows_selected.splice(index, 1);
            }

            if (this.checked) {
                $row.addClass('selected');
            } else {
                $row.removeClass('selected');
            }

            //checkLength();
            updateDataTableSelectAllCtrl(table);
            e.stopPropagation();
        });

        $('#myTable').on('click', 'tbody td, thead th:first-child', function (e) {
            $(this).parent().find('input[type="checkbox"]').trigger('click');
            //checkLength();
        });

        $('thead input[name="select_all"]', table.table().container()).on('click', function (e) {
            if (this.checked) {
                $('#myTable tbody input[type="checkbox"]:not(:checked)').trigger('click');
            } else {
                $('#myTable tbody input[type="checkbox"]:checked').trigger('click');
            }
            //checkLength();
            e.stopPropagation();
        });

        table.on('draw', function () {
            updateDataTableSelectAllCtrl(table);
            //checkLength();
        });

        //checkLength();

        // approve and reject btn click

            $("#btnReject").click(function () {
            $('#errorRejectReason').remove();
            $('#rejectReason').val("");
            $('#modal-default').modal('show');
        });

        $('#formApprove').on('submit', function (e) {

            $("#makerTranLogId").val(JSON.stringify(rows_selected));
        });

        $('#formReject').on('submit', function (e) {
            $("#idString_rej").val(JSON.stringify(rows_selected));
        });

        // check length of selected_row array
        function checkLength() {
            if (!rows_selected.length > 0) {
                $("#btnApprove").prop('disabled', true);
                $("#btnReject").prop('disabled', true);
            }
            else {
                $("#btnApprove").prop('disabled', false);
                $("#btnReject").prop('disabled', false);
            }
        }
    });

    function updateDataTableSelectAllCtrl(table) {
        var $table = table.table().node();
        var $chkbox_all = $('tbody input[type="checkbox"]', $table);
        var $chkbox_checked = $('tbody input[type="checkbox"]:checked', $table);
        var chkbox_select_all = $('thead input[name="select_all"]', $table).get(0);

        if ($chkbox_checked.length === 0) {
            chkbox_select_all.checked = false;
            if ('indeterminate' in chkbox_select_all) {
                chkbox_select_all.indeterminate = false;
            }

        } else if ($chkbox_checked.length === $chkbox_all.length) {
            chkbox_select_all.checked = true;
            if ('indeterminate' in chkbox_select_all) {
                chkbox_select_all.indeterminate = false;
            }

        } else {
            chkbox_select_all.checked = true;
            if ('indeterminate' in chkbox_select_all) {
                chkbox_select_all.indeterminate = true;
            }
        }

    }
</script>
